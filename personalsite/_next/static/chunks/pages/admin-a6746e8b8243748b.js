(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[309],{1565:(e,t,o)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return o(8014)}])},7746:(e,t,o)=>{"use strict";o.d(t,{A:()=>i});var n=o(7876),s=o(4232),a=o(1660),r=o(5176);function i(e){var t,o;let{existingBook:i,onSuccess:l}=e,[d,c]=(0,s.useState)((null==i?void 0:i.isbn)||""),[u,g]=(0,s.useState)((null==i?void 0:i.status)||"toRead"),[m,b]=(0,s.useState)((null==i?void 0:i.notes)||""),[h,f]=(0,s.useState)(i||null),[x,p]=(0,s.useState)(!1),[v,y]=(0,s.useState)(""),[j,k]=(0,s.useState)(""),{t:N}=(0,r.Bd)(),w=async()=>{if(!d){y("Please enter an ISBN");return}p(!0),y("");try{let e=await (0,a.xj)(d);e?f(e):y("Book not found. Please check the ISBN and try again.")}catch(e){console.error("Error looking up book:",e),y("Error looking up book. Please try again.")}finally{p(!1)}},S=async()=>{if(!h){y("Please look up a book first");return}p(!0),y("");try{let e={...h,...void 0!==h.averageRating?{}:{averageRating:null},status:u,notes:m,dateAdded:new Date().toISOString()};if(void 0!==e.averageRating){let t=Number(e.averageRating);if(isNaN(t))throw Error("Rating must be a valid number");t<0||t>5?(console.warn("Rating outside normal range: ".concat(t,", adjusting to limit")),e.averageRating=Math.max(0,Math.min(5,t))):e.averageRating=t}else e.averageRating=void 0;console.log("Formatted book data:",e),await (0,a.bp)(e),k("Book added successfully!"),c(""),g("toRead"),b(""),f(null),l&&l()}catch(e){console.error("Error adding book:",e),y("Error adding book: ".concat(e instanceof Error?e.message:"Please try again."))}finally{p(!1)}},_=async()=>{if(!i){y("No book to update");return}p(!0),y("");try{await (0,a.r3)(i.id,{status:u,notes:m}),k("Book updated successfully!"),l&&l()}catch(e){console.error("Error updating book:",e),y("Error updating book. Please try again.")}finally{p(!1)}},R=async()=>{if(i&&confirm("Are you sure you want to delete this book?")){p(!0),y("");try{await (0,a.HA)(i.id),k("Book deleted successfully!"),l&&l()}catch(e){console.error("Error deleting book:",e),y("Error deleting book. Please try again.")}finally{p(!1)}}};return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-accent mb-6",children:N("admin.bookManagement",i?"Edit Book":"Add New Book")}),v&&(0,n.jsx)("div",{className:"bg-red-100 text-red-700 p-3 rounded mb-4",children:v}),j&&(0,n.jsx)("div",{className:"bg-green-100 text-green-700 p-3 rounded mb-4",children:j}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:N("admin.isbn","ISBN:")}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),disabled:!!i,className:"\n              flex-grow px-3 py-2 border border-gray-300 rounded-l-md \n              focus:outline-none focus:ring-steel-blue focus:border-steel-blue\n              ".concat(i?"bg-gray-100":"","\n            "),placeholder:"Enter ISBN"}),!i&&(0,n.jsx)("button",{type:"button",onClick:w,disabled:x||!d,className:"\n                bg-steel-blue hover:bg-accent text-white font-medium py-2 px-4 rounded-r-md\n                transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-steel-blue\n                ".concat(x||!d?"opacity-70 cursor-not-allowed":"","\n              "),children:x?"Loading...":N("admin.lookup","Lookup")})]})]}),h&&(0,n.jsx)("div",{className:"mb-6 p-4 bg-light-accent rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(null===(t=h.imageLinks)||void 0===t?void 0:t.thumbnail)&&(0,n.jsx)("img",{src:h.imageLinks.thumbnail,alt:"Cover of ".concat(h.title),className:"w-20 h-auto mr-4"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold text-lg",children:h.title}),(0,n.jsx)("p",{className:"text-sm",children:null===(o=h.authors)||void 0===o?void 0:o.join(", ")}),h.categories&&(0,n.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:h.categories.join(", ")})]})]})}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:N("admin.status","Reading Status:")}),(0,n.jsxs)("select",{id:"status",value:u,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-steel-blue focus:border-steel-blue",children:[(0,n.jsx)("option",{value:"read",children:N("books.read","Read")}),(0,n.jsx)("option",{value:"reading",children:N("books.reading","Currently Reading")}),(0,n.jsx)("option",{value:"toRead",children:N("books.toRead","Want to Read")})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:N("admin.notes","Your Notes:")}),(0,n.jsx)("textarea",{id:"notes",value:m,onChange:e=>b(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-steel-blue focus:border-steel-blue",placeholder:"Your thoughts about this book..."})]}),(0,n.jsx)("div",{className:"flex justify-between",children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{type:"button",onClick:_,disabled:x,className:"\n                bg-steel-blue hover:bg-accent text-white font-medium py-2 px-4 rounded\n                transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-steel-blue\n                ".concat(x?"opacity-70 cursor-not-allowed":"","\n              "),children:x?"Saving...":N("admin.update","Update Book")}),(0,n.jsx)("button",{type:"button",onClick:R,disabled:x,className:"\n                bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded\n                transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600\n                ".concat(x?"opacity-70 cursor-not-allowed":"","\n              "),children:x?"Deleting...":N("admin.delete","Delete Book")})]}):(0,n.jsx)("button",{type:"button",onClick:S,disabled:x||!h,className:"\n              bg-steel-blue hover:bg-accent text-white font-medium py-2 px-4 rounded\n              transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-steel-blue\n              ".concat(x||!h?"opacity-70 cursor-not-allowed":"","\n            "),children:x?"Adding...":N("admin.add","Add to Collection")})})]})}},7964:(e,t,o)=>{"use strict";o.d(t,{J:()=>n});let n="/personalsite"},8014:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>m});var n=o(7876),s=o(4232),a=o(9099),r=o(1816),i=o(870);function l(e){let{message:t="Loading..."}=e;return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",children:[(0,n.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-steel-blue border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:t})]})}var d=o(7964);function c(e){let{children:t}=e,{user:o,loading:r}=(0,i.As)(),c=(0,a.useRouter)();return((0,s.useEffect)(()=>{let e=sessionStorage.getItem("auth_success"),t=sessionStorage.getItem("auth_timestamp");if("true"===sessionStorage.getItem("bypass_auth")){console.log("Using auth bypass");return}if("true"===e&&t){let e=new Date(t).getTime();if(new Date().getTime()-e<3e5){console.log("Recent auth success found, waiting for user to load");return}sessionStorage.removeItem("auth_success"),sessionStorage.removeItem("auth_timestamp")}if(!r&&!o){if(console.log("No authenticated user found, redirecting to login"),window.location.pathname.includes("/admin")&&(console.log("Suggesting alternative auth methods"),window.confirm("The regular login might not be working. Would you like to try an alternative login method?"))){window.location.href="".concat(d.J,"/admin-access.html");return}c.replace("".concat(d.J,"/admin/login"))}},[o,r,c]),r||"true"===sessionStorage.getItem("auth_success")&&!o)?(0,n.jsx)(l,{message:"Checking authentication..."}):"true"===sessionStorage.getItem("bypass_auth")?(0,n.jsx)(n.Fragment,{children:t}):o?(0,n.jsx)(n.Fragment,{children:t}):null}var u=o(7746),g=o(5176);function m(){let e=(0,a.useRouter)(),{signOut:t}=(0,i.As)(),{t:o}=(0,g.Bd)(),[l,m]=(0,s.useState)(!1),b=async()=>{await t(),e.push("".concat(d.J,"/"))};return(0,n.jsx)(c,{children:(0,n.jsx)(r.A,{section:"admin",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-accent",children:o("admin.bookManagement","Book Management")}),(0,n.jsx)("button",{onClick:b,className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded transition-colors",children:o("admin.signOut","Sign Out")})]}),l&&(0,n.jsx)("div",{className:"bg-green-100 text-green-700 p-3 rounded mb-4",children:o("admin.success","Operation completed successfully!")}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,n.jsx)(u.A,{onSuccess:()=>{m(!0),setTimeout(()=>m(!1),3e3)}})})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[25,974,636,593,792],()=>t(1565)),_N_E=e.O()}]);