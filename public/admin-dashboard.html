<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Personal Website</title>
  <style>
    :root {
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --text-color: #333;
      --bg-color: #f5f7fa;
      --card-bg: #fff;
      --border-color: #e5e7eb;
      --success-color: #22c55e;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 30px;
    }
    
    .header h1 {
      color: var(--primary-color);
      font-size: 24px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      text-align: center;
    }
    
    .stat-card h3 {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 10px;
    }
    
    .stat-card .value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
    }
    
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .tab {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--primary-color);
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 4px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: var(--primary-hover);
    }
    
    button:disabled {
      background-color: #93c5fd;
      cursor: not-allowed;
    }
    
    .secondary-button {
      background-color: #6b7280;
    }
    
    .secondary-button:hover {
      background-color: #4b5563;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th, .table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    .table th {
      background-color: #f8fafc;
      font-weight: 600;
      color: #6b7280;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 16px;
    }
    
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .alert {
      padding: 12px 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    
    .alert-error {
      background-color: #fee2e2;
      color: var(--error-color);
      border-left: 4px solid var(--error-color);
    }
    
    .alert-success {
      background-color: #dcfce7;
      color: var(--success-color);
      border-left: 4px solid var(--success-color);
    }
    
    .hidden {
      display: none;
    }
    
    .book-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 14px;
    }
    
    .btn-edit {
      background-color: #f59e0b;
    }
    
    .btn-edit:hover {
      background-color: #d97706;
    }
    
    .btn-delete {
      background-color: #ef4444;
    }
    
    .btn-delete:hover {
      background-color: #dc2626;
    }
    
    #statusMessage {
      padding: 12px 15px;
      border-radius: 4px;
      margin: 20px 0;
      display: none;
    }
    
    .auth-check {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--bg-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .auth-check h2 {
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Auth Check Screen -->
  <div id="authCheck" class="auth-check">
    <div class="loader"></div>
    <h2>Verifying Authentication</h2>
    <p>Please wait while we verify your credentials.</p>
    <div id="authMessage" style="margin-top: 15px;"></div>
  </div>
  
  <!-- Admin Dashboard -->
  <div id="adminDashboard" class="container" style="display: none;">
    <div class="header">
      <h1>Admin Dashboard</h1>
      <div class="user-info">
        <span id="userEmail"></span>
        <button id="logoutButton" class="btn-small">Logout</button>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="stat-card">
        <h3>Total Books</h3>
        <div class="value" id="totalBooks">0</div>
      </div>
      <div class="stat-card">
        <h3>Categories</h3>
        <div class="value" id="totalCategories">0</div>
      </div>
      <div class="stat-card">
        <h3>Fiction Books</h3>
        <div class="value" id="fictionBooks">0</div>
      </div>
      <div class="stat-card">
        <h3>Non-Fiction Books</h3>
        <div class="value" id="nonFictionBooks">0</div>
      </div>
    </div>
    
    <div class="tabs">
      <div class="tab active" data-tab="bookList">Book Management</div>
      <div class="tab" data-tab="addBook">Add New Book</div>
      <div class="tab" data-tab="blogManagement">Blog Management</div>
      <div class="tab" data-tab="siteAdmin">Site Analytics</div>
    </div>
    
    <div id="statusMessage"></div>
    
    <div id="bookListTab" class="tab-content active">
      <div class="card">
        <h2>Book Collection</h2>
        <div id="booksTableContainer">
          <table class="table" id="booksTable">
            <thead>
              <tr>
                <th>Title</th>
                <th>Author</th>
                <th>Category</th>
                <th>Year</th>
                <th>Status</th>
                <th>Rating</th>
                <th>ISBN</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="booksTableBody">
              <!-- Books will be loaded here -->
              <tr>
                <td colspan="8" style="text-align: center;">No books found. Add some books to see them here.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <div id="addBookTab" class="tab-content">
      <div class="card">
        <h2>Add New Book</h2>
        
        <!-- Book Search Options -->
        <div class="search-options" style="margin-bottom: 20px;">
          <div style="display: flex; margin-bottom: 15px;">
            <button type="button" id="searchByIsbnBtn" class="search-tab active" style="flex: 1; padding: 8px; border: none; border-radius: 4px 0 0 4px; cursor: pointer; background-color: var(--primary-color); color: white;">Search by ISBN</button>
            <button type="button" id="searchByTitleBtn" class="search-tab" style="flex: 1; padding: 8px; border: none; border-radius: 0 4px 4px 0; cursor: pointer; background-color: #e5e7eb; color: var(--text-color);">Search by Title/Author</button>
          </div>
          
          <!-- ISBN Search -->
          <div id="isbnSearchContainer" class="search-container" style="margin-bottom: 20px;">
            <div style="display: flex;">
              <input type="text" id="isbnSearch" placeholder="Enter ISBN (e.g., 9780061122415)" style="flex-grow: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px 0 0 4px;">
              <button type="button" id="isbnSearchBtn" style="padding: 10px 15px; border: none; border-radius: 0 4px 4px 0; background-color: var(--primary-color); color: white; cursor: pointer;">Lookup</button>
            </div>
          </div>
          
          <!-- Title/Author Search -->
          <div id="titleSearchContainer" class="search-container" style="display: none; margin-bottom: 20px;">
            <div style="display: flex;">
              <input type="text" id="titleSearch" placeholder="Enter title or author name" style="flex-grow: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px 0 0 4px;">
              <button type="button" id="titleSearchBtn" style="padding: 10px 15px; border: none; border-radius: 0 4px 4px 0; background-color: var(--primary-color); color: white; cursor: pointer;">Search</button>
            </div>
          </div>
        </div>
        
        <!-- Search Results -->
        <div id="searchResults" style="display: none; max-height: 300px; overflow-y: auto; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 4px;">
          <div id="searchResultsList"></div>
        </div>
        
        <!-- Book Preview -->
        <div id="bookPreview" style="display: none; margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 4px;">
          <div style="display: flex; align-items: start;">
            <div id="bookPreviewCover" style="width: 80px; height: 120px; background-color: #ddd; margin-right: 15px; text-align: center; line-height: 120px; font-size: 10px;">No Cover</div>
            <div>
              <h3 id="bookPreviewTitle" style="margin: 0 0 5px 0; font-size: 18px;">Book Title</h3>
              <p id="bookPreviewAuthor" style="margin: 0 0 5px 0; font-size: 14px; color: #666;">Author Name</p>
              <p id="bookPreviewPublisher" style="margin: 0; font-size: 12px; color: #666;">Publisher, Year</p>
              <p id="bookPreviewIsbn" style="margin: 5px 0 0 0; font-size: 12px; color: #666;">ISBN: 1234567890</p>
            </div>
          </div>
          <div id="bookPreviewDescription" style="margin-top: 15px; font-size: 14px; max-height: 100px; overflow-y: auto;"></div>
        </div>
        
        <!-- Manual Book Form -->
        <form id="bookForm" class="book-form">
          <div class="form-group">
            <label for="title">Title</label>
            <input type="text" id="title" required>
          </div>
          
          <div class="form-group">
            <label for="author">Author</label>
            <input type="text" id="author" required>
          </div>
          
          <div class="form-group">
            <label for="category">Category</label>
            <input type="text" id="category" required placeholder="e.g. Fiction, Science, History">
          </div>
          
          <div class="form-group">
            <label for="year">Year Published</label>
            <input type="number" id="year" required min="1000" max="2100">
          </div>
          
          <div class="form-group">
            <label for="status">Reading Status</label>
            <select id="status" required>
              <option value="read">Read</option>
              <option value="reading">Currently Reading</option>
              <option value="toRead">Want to Read</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="userRating">My Rating</label>
            <select id="userRating">
              <option value="">-- Select Rating --</option>
              <option value="5">★★★★★ (5/5) - Excellent</option>
              <option value="4">★★★★☆ (4/5) - Very Good</option>
              <option value="3">★★★☆☆ (3/5) - Good</option>
              <option value="2">★★☆☆☆ (2/5) - Fair</option>
              <option value="1">★☆☆☆☆ (1/5) - Poor</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="notes">My Notes & Review</label>
            <textarea id="notes" rows="4" placeholder="Your personal thoughts, reviews, or notes about the book..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="description">Book Description</label>
            <textarea id="description" rows="4"></textarea>
          </div>
          
          <div class="form-group">
            <label for="coverImage">Cover Image URL</label>
            <input type="url" id="coverImage" placeholder="https://example.com/book-cover.jpg">
          </div>
          
          <input type="hidden" id="bookId">
          <input type="hidden" id="bookIsbn">
          <button type="submit" id="saveBookButton">Save Book</button>
        </form>
      </div>
    </div>
    
    <div id="blogManagementTab" class="tab-content">
      <div class="card">
        <h2>Blog Management</h2>
        
        <div class="tabs mt-4" style="border-bottom: 1px solid #e5e7eb;">
          <div class="tab active" data-blog-tab="postList">All Posts</div>
          <div class="tab" data-blog-tab="newPost">New Post</div>
          <div class="tab" data-blog-tab="categories">Categories</div>
          <div class="tab" data-blog-tab="analytics">Analytics</div>
        </div>
        
        <!-- Post List Tab -->
        <div id="postListTab" class="blog-tab-content active">
          <div style="margin: 20px 0; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <input type="text" id="postSearch" placeholder="Search posts..." style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px;">
              <select id="postFilter" style="margin-left: 8px; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px;">
                <option value="all">All Posts</option>
                <option value="published">Published</option>
                <option value="draft">Drafts</option>
                <option value="scheduled">Scheduled</option>
              </select>
            </div>
            <button id="newPostBtn" class="btn-small">New Post</button>
          </div>
          
          <table class="table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Status</th>
                <th>Date</th>
                <th>Author</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="postsTableBody">
              <!-- Posts will be loaded here -->
              <tr>
                <td colspan="5" style="text-align: center;">No posts found. Create a new post to get started.</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- New Post Tab -->
        <div id="newPostTab" class="blog-tab-content" style="display: none;">
          <div style="margin-top: 20px;">
            <form id="postForm">
              <div class="form-group">
                <label for="postTitle">Title</label>
                <input type="text" id="postTitle" required>
              </div>
              
              <div class="form-group">
                <label for="postSlug">URL Slug</label>
                <input type="text" id="postSlug" required>
              </div>
              
              <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                <div class="form-group" style="flex: 1;">
                  <label for="postStatus">Status</label>
                  <select id="postStatus" required>
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                    <option value="scheduled">Scheduled</option>
                  </select>
                </div>
                
                <div class="form-group" style="flex: 1;">
                  <label for="postCategory">Category</label>
                  <select id="postCategory" required>
                    <option value="">-- Select Category --</option>
                    <option value="technology">Technology</option>
                    <option value="programming">Programming</option>
                    <option value="design">Design</option>
                    <option value="business">Business</option>
                    <option value="personal">Personal</option>
                  </select>
                </div>
              </div>
              
              <div id="schedulingOptions" class="form-group" style="display: none;">
                <label for="scheduleDate">Publish Date</label>
                <input type="datetime-local" id="scheduleDate">
              </div>
              
              <div class="form-group">
                <label for="metaDescription">Meta Description <span style="font-weight: normal; font-size: 12px; color: #6b7280;">(50-160 chars recommended)</span></label>
                <textarea id="metaDescription" rows="2" maxlength="250"></textarea>
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-top: 5px;">
                  <span>Characters: <span id="metaDescLength">0</span>/250</span>
                  <span id="metaDescStatus">Too short</span>
                </div>
              </div>
              
              <div class="form-group">
                <label for="postTags">Tags <span style="font-weight: normal; font-size: 12px; color: #6b7280;">(comma separated)</span></label>
                <input type="text" id="postTags" placeholder="e.g. react, javascript, tutorial">
              </div>
              
              <div class="form-group">
                <label for="postContent">Content</label>
                
                <!-- Markdown Toolbar -->
                <div id="editorToolbar" style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; padding: 5px; border: 1px solid var(--border-color); border-radius: 4px; background-color: #f8fafc;">
                  <button type="button" data-format="bold" title="Bold (Ctrl+B)" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 Bold</button>
                  <button type="button" data-format="italic" title="Italic (Ctrl+I)" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 Italic</button>
                  <button type="button" data-format="heading" title="Heading" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 H2</button>
                  <button type="button" data-format="link" title="Link (Ctrl+K)" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 Link</button>
                  <button type="button" data-format="list" title="Bullet List" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 List</button>
                  <button type="button" data-format="quote" title="Quote" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 Quote</button>
                  <button type="button" data-format="code" title="Code Block" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 Code</button>
                  <button type="button" data-format="image" title="Image" class="btn-small" style="min-width: unset; height: 30px; line-height: 1;">📝 Image</button>
                  
                  <!-- Word Counter -->
                  <div style="margin-left: auto; display: flex; align-items: center; color: #6b7280; font-size: 12px;">
                    <span>Words: <span id="wordCount">0</span></span>
                    <span style="margin-left: 10px;">Chars: <span id="charCount">0</span></span>
                  </div>
                  
                  <!-- Preview Button -->
                  <button type="button" id="previewBtn" title="Preview" class="btn-small" style="margin-left: 10px; background-color: #4b5563;">👁️ Preview</button>
                </div>
                
                <textarea id="postContent" rows="20" style="font-family: monospace;"></textarea>
              </div>
              
              <div class="form-group">
                <label for="postImage">Featured Image URL</label>
                <input type="url" id="postImage" placeholder="https://example.com/image.jpg">
              </div>
              
              <button type="submit" id="savePostButton">Save Post</button>
            </form>
          </div>
        </div>
        
        <!-- Categories Tab -->
        <div id="categoriesTab" class="blog-tab-content" style="display: none;">
          <div style="margin-top: 20px; display: flex; gap: 20px;">
            <div style="flex: 1;">
              <h3 style="margin-bottom: 15px; font-size: 18px;">Categories</h3>
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Slug</th>
                    <th>Posts</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="categoriesTableBody">
                  <tr>
                    <td>Technology</td>
                    <td>technology</td>
                    <td>4</td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-small btn-edit">Edit</button>
                        <button class="btn-small btn-delete">Delete</button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>Programming</td>
                    <td>programming</td>
                    <td>6</td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-small btn-edit">Edit</button>
                        <button class="btn-small btn-delete">Delete</button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>Design</td>
                    <td>design</td>
                    <td>2</td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-small btn-edit">Edit</button>
                        <button class="btn-small btn-delete">Delete</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div style="flex: 1;">
              <h3 style="margin-bottom: 15px; font-size: 18px;">Add New Category</h3>
              <form id="categoryForm">
                <div class="form-group">
                  <label for="categoryName">Name</label>
                  <input type="text" id="categoryName" required>
                </div>
                
                <div class="form-group">
                  <label for="categorySlug">Slug</label>
                  <input type="text" id="categorySlug" required>
                </div>
                
                <div class="form-group">
                  <label for="categoryDescription">Description</label>
                  <textarea id="categoryDescription" rows="3"></textarea>
                </div>
                
                <button type="submit" id="saveCategoryButton">Add Category</button>
              </form>
            </div>
          </div>
        </div>
        
        <!-- Analytics Tab -->
        <div id="analyticsTab" class="blog-tab-content" style="display: none;">
          <div style="margin-top: 20px;">
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
              <div style="border: 1px solid var(--border-color); border-radius: 4px; padding: 15px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: var(--primary-color); margin-bottom: 5px;">156</div>
                <div style="font-size: 14px; color: #6b7280;">Total Views This Month</div>
              </div>
              <div style="border: 1px solid var(--border-color); border-radius: 4px; padding: 15px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: var(--success-color); margin-bottom: 5px;">43</div>
                <div style="font-size: 14px; color: #6b7280;">New Subscribers</div>
              </div>
              <div style="border: 1px solid var(--border-color); border-radius: 4px; padding: 15px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #3b82f6; margin-bottom: 5px;">3.2</div>
                <div style="font-size: 14px; color: #6b7280;">Avg. Time on Page (min)</div>
              </div>
            </div>
            
            <div style="border: 1px solid var(--border-color); border-radius: 4px; padding: 15px; margin-bottom: 25px;">
              <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 18px;">Top Posts</h3>
              <table class="table">
                <thead>
                  <tr>
                    <th>Post</th>
                    <th>Views</th>
                    <th>Comments</th>
                    <th>Avg. Time</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>How to Build a React App with Firebase</td>
                    <td>42</td>
                    <td>7</td>
                    <td>4.5 min</td>
                  </tr>
                  <tr>
                    <td>Getting Started with TypeScript</td>
                    <td>38</td>
                    <td>5</td>
                    <td>3.2 min</td>
                  </tr>
                  <tr>
                    <td>Best Practices for Modern Web Development</td>
                    <td>27</td>
                    <td>3</td>
                    <td>2.8 min</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div style="border: 1px solid var(--border-color); border-radius: 4px; padding: 15px;">
              <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 18px;">Traffic Sources</h3>
              <div style="min-height: 200px; background-color: #f1f5f9; display: flex; align-items: center; justify-content: center; border-radius: 4px;">
                <p style="color: #64748b;">Chart visualization will appear here</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="siteAdminTab" class="tab-content">
      <!-- Analytics content will be loaded dynamically by admin-dashboard-analytics.js -->
    </div>
  </div>
  
  <!-- Preview Modal -->
  <div id="previewModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); overflow: auto;">
    <div style="background-color: #fff; margin: 10% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 800px; position: relative; max-height: 80vh; overflow-y: auto;">
      <span id="closePreview" style="position: absolute; top: 10px; right: 15px; font-size: 22px; cursor: pointer; color: #6b7280;">&times;</span>
      <h2 style="margin-top: 5px; margin-bottom: 15px;">Preview</h2>
      <div id="previewContent" style="line-height: 1.6;"></div>
    </div>
  </div>
  
  <!-- Firebase script -->
  <script type="module">
    // Import the functions you need from the SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, doc, addDoc, updateDoc, deleteDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    
    // Initialize Firebase (config will be loaded from global variable)
    let app;
    let auth;
    let db;
    
    // Global message container
    const statusMessage = document.getElementById('statusMessage');
    
    // Check authentication first
    document.addEventListener('DOMContentLoaded', function() {
      // Auth check elements
      const authCheck = document.getElementById('authCheck');
      const authMessage = document.getElementById('authMessage');
      const adminDashboard = document.getElementById('adminDashboard');
      
      // Check if we have Firebase config
      let firebaseConfig = null;
      
      // Try to use SECURE_CONFIG first
      if (window.SECURE_CONFIG?.firebase?.apiKey) {
        console.log('Using Firebase config from SECURE_CONFIG');
        firebaseConfig = window.SECURE_CONFIG.firebase;
      } 
      // Fall back to runtimeConfig
      else if (window.runtimeConfig?.firebase?.apiKey) {
        console.log('Using Firebase config from runtimeConfig');
        firebaseConfig = window.runtimeConfig.firebase;
      }
      
      if (!firebaseConfig?.apiKey) {
        authMessage.innerHTML = `
          <div style="color: #ef4444; margin-top: 10px;">
            <p><strong>Firebase credentials missing</strong></p>
            <p style="margin-top: 8px; font-size: 14px;">This is expected in development. In production, these values would be populated during deployment.</p>
            <p style="margin-top: 8px; font-size: 14px;">For local testing, you can manually configure the Firebase keys in public/secure-config.js</p>
          </div>`;
        console.warn('Firebase config not available - this is expected in development environments');
        return;
      }
      
      try {
        // Initialize Firebase
        app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);
        
        // Check current auth state
        onAuthStateChanged(auth, (user) => {
          if (user) {
            // User is signed in
            console.log('User is authenticated:', user.email);
            
            // Only allow admin users
            if (!user.email.endsWith('@admin.com') && !user.email.includes('admin')) {
              authMessage.innerHTML = '<div style="color: #ef4444; margin-top: 10px;">Error: You do not have admin privileges.</div>';
              signOut(auth);
              return;
            }
            
            // Hide auth check, show dashboard
            authCheck.style.display = 'none';
            adminDashboard.style.display = 'block';
            
            // Set user info
            document.getElementById('userEmail').textContent = user.email;
            
            // Setup dashboard
            setupDashboard(db);
          } else {
            // No user is signed in, redirect to login
            window.location.href = '/admin/login';
          }
        });
      } catch (error) {
        console.error('Error initializing Firebase:', error);
        authMessage.innerHTML = `<div style="color: #ef4444; margin-top: 10px;">Error: ${error.message}</div>`;
      }
    });
    
    // Logout functionality
    document.getElementById('logoutButton').addEventListener('click', function() {
      if (auth) {
        signOut(auth).then(() => {
          // Redirect to login page
          window.location.href = '/admin/login';
        }).catch((error) => {
          console.error('Error signing out:', error);
          showMessage('Error signing out. Please try again.', 'error');
        });
      }
    });
    
    // Setup dashboard functionality
    function setupDashboard(db) {
      // Tab navigation
      const tabs = document.querySelectorAll('[data-tab]');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // Remove active class from all tabs
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // Hide all tab content
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // Show selected tab content
          const tabId = this.getAttribute('data-tab') + 'Tab';
          document.getElementById(tabId).classList.add('active');
        });
      });
      
      // Load books
      loadBooks(db);
      
      // Setup book management
      setupBookManagement(db);
      
      // Setup blog management
      setupBlogManagement(db);
    }
    
    // Load books from Firestore
    async function loadBooks(db) {
      try {
        const booksCollection = collection(db, 'books');
        const booksSnapshot = await getDocs(booksCollection);
        
        if (booksSnapshot.empty) {
          console.log('No books found in collection');
          return;
        }
        
        // Convert to array of books
        const books = [];
        booksSnapshot.forEach(doc => {
          books.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        // Update book count stats
        document.getElementById('totalBooks').textContent = books.length;
        
        // Count books by category
        const categories = new Set();
        let fictionCount = 0;
        let nonFictionCount = 0;
        
        books.forEach(book => {
          if (book.categories && Array.isArray(book.categories)) {
            book.categories.forEach(category => categories.add(category));
            
            // Very simplistic fiction detection
            const lowerCategories = book.categories.map(c => c.toLowerCase());
            if (
              lowerCategories.includes('fiction') || 
              lowerCategories.includes('novel') ||
              lowerCategories.includes('sci-fi') ||
              lowerCategories.includes('science fiction') ||
              lowerCategories.includes('fantasy')
            ) {
              fictionCount++;
            } else {
              nonFictionCount++;
            }
          }
        });
        
        document.getElementById('totalCategories').textContent = categories.size;
        document.getElementById('fictionBooks').textContent = fictionCount;
        document.getElementById('nonFictionBooks').textContent = nonFictionCount;
        
        // Populate books table
        populateBooksTable(books);
      } catch (error) {
        console.error('Error loading books:', error);
        showMessage('Error loading books from the database', 'error');
      }
    }
    
    // Populate books table
    function populateBooksTable(books) {
      const booksTableBody = document.getElementById('booksTableBody');
      
      if (books.length === 0) {
        booksTableBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center;">No books found. Add some books to see them here.</td>
          </tr>
        `;
        return;
      }
      
      // Sort books by date added (newest first)
      books.sort((a, b) => {
        if (!a.dateAdded) return 1;
        if (!b.dateAdded) return -1;
        return new Date(b.dateAdded) - new Date(a.dateAdded);
      });
      
      // Clear existing rows
      booksTableBody.innerHTML = '';
      
      // Add book rows
      books.forEach(book => {
        const row = document.createElement('tr');
        
        // Format author text safely
        let authorText = 'Unknown Author';
        if (book.authors) {
          if (typeof book.authors === 'string') {
            authorText = book.authors;
          } else if (Array.isArray(book.authors)) {
            authorText = book.authors.join(', ');
          }
        }
        
        // Format category text safely
        let categoryText = '';
        if (book.categories) {
          if (typeof book.categories === 'string') {
            categoryText = book.categories;
          } else if (Array.isArray(book.categories)) {
            categoryText = book.categories.join(', ');
          }
        }
        
        // Format status
        const statusMap = {
          'read': 'Read',
          'reading': 'Reading',
          'toRead': 'To Read'
        };
        const status = statusMap[book.status] || book.status;
        
        // Format rating
        const rating = book.userRating 
          ? '★'.repeat(book.userRating) + '☆'.repeat(5 - book.userRating)
          : '';
        
        row.innerHTML = `
          <td>${book.title || 'Untitled Book'}</td>
          <td>${authorText}</td>
          <td>${categoryText}</td>
          <td>${book.publishedDate ? book.publishedDate.substring(0, 4) : ''}</td>
          <td>${status}</td>
          <td>${rating}</td>
          <td>${book.isbn || ''}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-small btn-edit" data-id="${book.id}">Edit</button>
              <button class="btn-small btn-delete" data-id="${book.id}">Delete</button>
            </div>
          </td>
        `;
        
        booksTableBody.appendChild(row);
      });
      
      // Add event listeners to edit/delete buttons
      booksTableBody.querySelectorAll('.btn-edit').forEach(button => {
        button.addEventListener('click', function() {
          const bookId = this.getAttribute('data-id');
          editBook(books.find(book => book.id === bookId));
        });
      });
      
      booksTableBody.querySelectorAll('.btn-delete').forEach(button => {
        button.addEventListener('click', function() {
          const bookId = this.getAttribute('data-id');
          deleteBook(bookId);
        });
      });
    }
    
    // Edit book
    function editBook(book) {
      if (!book) {
        console.error('Book not found');
        return;
      }
      
      // Switch to add book tab
      document.querySelector('[data-tab="addBook"]').click();
      
      // Set form values
      document.getElementById('bookId').value = book.id;
      document.getElementById('title').value = book.title || '';
      
      // Handle authors field safely
      if (book.authors) {
        if (typeof book.authors === 'string') {
          document.getElementById('author').value = book.authors;
        } else if (Array.isArray(book.authors)) {
          document.getElementById('author').value = book.authors.join(', ');
        }
      } else {
        document.getElementById('author').value = '';
      }
      
      // Handle categories safely
      if (book.categories) {
        if (typeof book.categories === 'string') {
          document.getElementById('category').value = book.categories;
        } else if (Array.isArray(book.categories) && book.categories.length > 0) {
          document.getElementById('category').value = book.categories.join(', ');
        } else {
          document.getElementById('category').value = '';
        }
      } else {
        document.getElementById('category').value = '';
      }
      
      document.getElementById('year').value = book.publishedDate ? book.publishedDate.substring(0, 4) : '';
      document.getElementById('status').value = book.status || 'read';
      document.getElementById('userRating').value = book.userRating || '';
      document.getElementById('notes').value = book.notes || '';
      document.getElementById('description').value = book.description || '';
      
      // Handle cover image URL - either from small/thumbnail or coverImage field
      let coverImageUrl = '';
      if (book.imageLinks) {
        coverImageUrl = book.imageLinks.thumbnail || book.imageLinks.smallThumbnail || '';
      }
      document.getElementById('coverImage').value = coverImageUrl;
      document.getElementById('bookIsbn').value = book.isbn || '';
      
      // Scroll to top of form
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }
    
    // Delete book
    async function deleteBook(bookId) {
      if (!confirm('Are you sure you want to delete this book? This action cannot be undone.')) {
        return;
      }
      
      try {
        await deleteDoc(doc(db, 'books', bookId));
        showMessage('Book deleted successfully', 'success');
        
        // Reload books
        loadBooks(db);
      } catch (error) {
        console.error('Error deleting book:', error);
        showMessage('Error deleting book. Please try again.', 'error');
      }
    }
    
    // Setup book management
    function setupBookManagement(db) {
      // Book search functionality
      const searchByIsbnBtn = document.getElementById('searchByIsbnBtn');
      const searchByTitleBtn = document.getElementById('searchByTitleBtn');
      const isbnSearchContainer = document.getElementById('isbnSearchContainer');
      const titleSearchContainer = document.getElementById('titleSearchContainer');
      
      searchByIsbnBtn.addEventListener('click', function() {
        this.classList.add('active');
        searchByTitleBtn.classList.remove('active');
        searchByTitleBtn.style.backgroundColor = '#e5e7eb';
        searchByTitleBtn.style.color = 'var(--text-color)';
        searchByIsbnBtn.style.backgroundColor = 'var(--primary-color)';
        searchByIsbnBtn.style.color = 'white';
        isbnSearchContainer.style.display = 'block';
        titleSearchContainer.style.display = 'none';
      });
      
      searchByTitleBtn.addEventListener('click', function() {
        this.classList.add('active');
        searchByIsbnBtn.classList.remove('active');
        searchByIsbnBtn.style.backgroundColor = '#e5e7eb';
        searchByIsbnBtn.style.color = 'var(--text-color)';
        searchByTitleBtn.style.backgroundColor = 'var(--primary-color)';
        searchByTitleBtn.style.color = 'white';
        isbnSearchContainer.style.display = 'none';
        titleSearchContainer.style.display = 'block';
      });
      
      // ISBN Search functionality
      const isbnSearchInput = document.getElementById('isbnSearch');
      const isbnSearchBtn = document.getElementById('isbnSearchBtn');
      
      isbnSearchBtn.addEventListener('click', function() {
        const isbn = isbnSearchInput.value.trim().replace(/-/g, '');
        
        if (!isbn) {
          alert('Please enter an ISBN');
          return;
        }
        
        searchBookByISBN(isbn);
      });
      
      // Title/Author Search functionality
      const titleSearchInput = document.getElementById('titleSearch');
      const titleSearchBtn = document.getElementById('titleSearchBtn');
      
      titleSearchBtn.addEventListener('click', function() {
        const query = titleSearchInput.value.trim();
        
        if (!query) {
          alert('Please enter a search term');
          return;
        }
        
        searchBookByTitle(query);
      });
      
      // Book form submission
      const bookForm = document.getElementById('bookForm');
      
      bookForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Get form values
        const bookId = document.getElementById('bookId').value;
        const title = document.getElementById('title').value;
        const author = document.getElementById('author').value;
        const category = document.getElementById('category').value;
        const year = document.getElementById('year').value;
        const status = document.getElementById('status').value;
        const userRating = document.getElementById('userRating').value;
        const notes = document.getElementById('notes').value;
        const description = document.getElementById('description').value;
        const coverImage = document.getElementById('coverImage').value;
        const isbn = document.getElementById('bookIsbn').value;
        
        // Validate form
        if (!title || !author) {
          alert('Title and author are required');
          return;
        }
        
        // Prepare book data
        const bookData = {
          title,
          authors: author.split(',').map(a => a.trim()),
          categories: category.split(',').map(c => c.trim()),
          publishedDate: year ? `${year}` : null,
          status,
          notes,
          description,
          isbn,
          imageLinks: {
            thumbnail: coverImage
          },
          dateAdded: new Date().toISOString()
        };
        
        // Add user rating if provided
        if (userRating) {
          bookData.userRating = parseInt(userRating);
        }
        
        try {
          if (bookId) {
            // Update existing book
            await updateDoc(doc(db, 'books', bookId), bookData);
            showMessage('Book updated successfully', 'success');
          } else {
            // Add new book
            await addDoc(collection(db, 'books'), bookData);
            showMessage('Book added successfully', 'success');
          }
          
          // Clear form
          bookForm.reset();
          document.getElementById('bookId').value = '';
          document.getElementById('bookPreview').style.display = 'none';
          
          // Reload books
          loadBooks(db);
          
          // Switch to book list tab
          document.querySelector('[data-tab="bookList"]').click();
        } catch (error) {
          console.error('Error saving book:', error);
          showMessage('Error saving book. Please try again.', 'error');
        }
      });
      
      // Book search functions
      async function searchBookByISBN(isbn) {
        try {
          const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`);
          const data = await response.json();
          
          if (!data.items || data.items.length === 0) {
            alert('No books found with that ISBN. Try a different search or add the book manually.');
            return;
          }
          
          const searchResults = document.getElementById('searchResults');
          const searchResultsList = document.getElementById('searchResultsList');
          searchResultsList.innerHTML = '';
          
          data.items.forEach(item => {
            const book = item.volumeInfo;
            
            // Create result item
            const resultItem = document.createElement('div');
            resultItem.style.padding = '10px';
            resultItem.style.borderBottom = '1px solid var(--border-color)';
            resultItem.style.cursor = 'pointer';
            resultItem.innerHTML = `
              <div style="display: flex; align-items: start;">
                <div style="width: 50px; height: 75px; background-color: #ddd; margin-right: 10px; text-align: center; font-size: 8px; line-height: 75px;">
                  ${book.imageLinks?.smallThumbnail ? `<img src="${book.imageLinks.smallThumbnail}" alt="Cover" style="width: 100%; height: 100%; object-fit: cover;">` : 'No Cover'}
                </div>
                <div>
                  <div style="font-weight: 500;">${book.title}</div>
                  <div style="font-size: 12px; color: #6b7280;">${book.authors ? book.authors.join(', ') : 'Unknown Author'}</div>
                  <div style="font-size: 12px; color: #6b7280;">${book.publishedDate || ''}</div>
                </div>
              </div>
            `;
            
            // Add click handler
            resultItem.addEventListener('click', function() {
              populateBookPreview(book, isbn);
              populateBookForm(book, isbn);
              searchResults.style.display = 'none';
            });
            
            searchResultsList.appendChild(resultItem);
          });
          
          searchResults.style.display = 'block';
        } catch (error) {
          console.error('Error searching by ISBN:', error);
          alert('Error searching for books. Please try again.');
        }
      }
      
      async function searchBookByTitle(query) {
        try {
          const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}`);
          const data = await response.json();
          
          if (!data.items || data.items.length === 0) {
            alert('No books found with that query. Try a different search or add the book manually.');
            return;
          }
          
          const searchResults = document.getElementById('searchResults');
          const searchResultsList = document.getElementById('searchResultsList');
          searchResultsList.innerHTML = '';
          
          data.items.forEach(item => {
            const book = item.volumeInfo;
            const isbn = book.industryIdentifiers ? 
              book.industryIdentifiers.find(id => id.type === 'ISBN_13' || id.type === 'ISBN_10')?.identifier || '' : '';
            
            // Create result item
            const resultItem = document.createElement('div');
            resultItem.style.padding = '10px';
            resultItem.style.borderBottom = '1px solid var(--border-color)';
            resultItem.style.cursor = 'pointer';
            resultItem.innerHTML = `
              <div style="display: flex; align-items: start;">
                <div style="width: 50px; height: 75px; background-color: #ddd; margin-right: 10px; text-align: center; font-size: 8px; line-height: 75px;">
                  ${book.imageLinks?.smallThumbnail ? `<img src="${book.imageLinks.smallThumbnail}" alt="Cover" style="width: 100%; height: 100%; object-fit: cover;">` : 'No Cover'}
                </div>
                <div>
                  <div style="font-weight: 500;">${book.title}</div>
                  <div style="font-size: 12px; color: #6b7280;">${book.authors ? book.authors.join(', ') : 'Unknown Author'}</div>
                  <div style="font-size: 12px; color: #6b7280;">${book.publishedDate || ''}</div>
                  ${isbn ? `<div style="font-size: 12px; color: #6b7280;">ISBN: ${isbn}</div>` : ''}
                </div>
              </div>
            `;
            
            // Add click handler
            resultItem.addEventListener('click', function() {
              populateBookPreview(book, isbn);
              populateBookForm(book, isbn);
              searchResults.style.display = 'none';
            });
            
            searchResultsList.appendChild(resultItem);
          });
          
          searchResults.style.display = 'block';
        } catch (error) {
          console.error('Error searching by title:', error);
          alert('Error searching for books. Please try again.');
        }
      }
      
      // Populate book preview
      function populateBookPreview(book, isbn) {
        const bookPreview = document.getElementById('bookPreview');
        const bookPreviewTitle = document.getElementById('bookPreviewTitle');
        const bookPreviewAuthor = document.getElementById('bookPreviewAuthor');
        const bookPreviewPublisher = document.getElementById('bookPreviewPublisher');
        const bookPreviewIsbn = document.getElementById('bookPreviewIsbn');
        const bookPreviewDescription = document.getElementById('bookPreviewDescription');
        const bookPreviewCover = document.getElementById('bookPreviewCover');
        
        bookPreviewTitle.textContent = book.title || 'Unknown Title';
        bookPreviewAuthor.textContent = book.authors ? book.authors.join(', ') : 'Unknown Author';
        bookPreviewPublisher.textContent = `${book.publisher || 'Unknown Publisher'}${book.publishedDate ? ', ' + book.publishedDate : ''}`;
        bookPreviewIsbn.textContent = `ISBN: ${isbn || 'Unknown'}`;
        
        // Set description
        bookPreviewDescription.textContent = book.description || 'No description available';
        
        // If we have Google ratings, add them to the description
        if (book.averageRating) {
          const googleRating = '★'.repeat(Math.round(book.averageRating)) + 
                               '☆'.repeat(5 - Math.round(book.averageRating));
          const ratingsInfo = `\n\nGoogle Rating: ${googleRating} (${book.averageRating}/5 from ${book.ratingsCount} ratings)`;
          bookPreviewDescription.textContent += ratingsInfo;
        }
        
        // Handle cover image
        if (book.imageLinks && book.imageLinks.thumbnail) {
          bookPreviewCover.innerHTML = `<img src="${book.imageLinks.thumbnail}" alt="Book cover" style="width: 100%; height: 100%; object-fit: cover;">`;
        } else {
          bookPreviewCover.innerHTML = 'No Cover';
        }
        
        bookPreview.style.display = 'block';
      }
      
      // Populate book form
      function populateBookForm(book, isbn) {
        document.getElementById('title').value = book.title || '';
        document.getElementById('author').value = book.authors ? book.authors.join(', ') : '';
        document.getElementById('category').value = book.categories ? book.categories[0] : '';
        document.getElementById('year').value = book.publishedDate ? book.publishedDate.substring(0, 4) : '';
        document.getElementById('description').value = book.description || '';
        
        // Set the cover image URL - store in the right format for BookSpine component
        const coverImageUrl = book.imageLinks && book.imageLinks.thumbnail ? book.imageLinks.thumbnail : '';
        document.getElementById('coverImage').value = coverImageUrl;
        document.getElementById('bookIsbn').value = isbn || '';
        
        // Set default status to "Want to Read" for new books
        const statusSelect = document.getElementById('status');
        statusSelect.value = 'toRead';
        
        // Reset notes and rating for new books
        document.getElementById('notes').value = '';
        document.getElementById('userRating').selectedIndex = 0;
      }
      
      // Show message function
      function showMessage(message, type) {
        statusMessage.textContent = message;
        statusMessage.className = '';
        statusMessage.classList.add('alert', `alert-${type}`);
        statusMessage.style.display = 'block';
        
        // Hide message after 3 seconds
        setTimeout(function() {
          statusMessage.style.display = 'none';
        }, 3000);
      }
      
      // Add event listeners for enter key in search inputs
      isbnSearchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          isbnSearchBtn.click();
        }
      });
      
      titleSearchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          titleSearchBtn.click();
        }
      });
    }
    
    // Setup Blog Management
    function setupBlogManagement(db) {
      // Blog tab navigation
      const blogTabs = document.querySelectorAll('[data-blog-tab]');
      
      if (blogTabs.length > 0) {
        blogTabs.forEach(tab => {
          tab.addEventListener('click', function() {
            // Remove active class from all tabs
            blogTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Hide all blog tab content
            document.querySelectorAll('.blog-tab-content').forEach(content => {
              content.style.display = 'none';
            });
            
            // Show selected tab content
            const tabId = this.getAttribute('data-blog-tab') + 'Tab';
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
              tabContent.style.display = 'block';
            } else {
              console.error(`Tab content with id ${tabId} not found!`);
            }
          });
        });
      }
      
      // New Post button
      const newPostBtn = document.getElementById('newPostBtn');
      if (newPostBtn) {
        newPostBtn.addEventListener('click', function() {
          document.querySelector('[data-blog-tab="newPost"]').click();
        });
      }
      
      // Post status change handler
      const postStatus = document.getElementById('postStatus');
      const schedulingOptions = document.getElementById('schedulingOptions');
      if (postStatus && schedulingOptions) {
        postStatus.addEventListener('change', function() {
          if (this.value === 'scheduled') {
            schedulingOptions.style.display = 'block';
          } else {
            schedulingOptions.style.display = 'none';
          }
        });
      }
      
      // Meta description character counter
      const metaDescription = document.getElementById('metaDescription');
      const metaDescLength = document.getElementById('metaDescLength');
      const metaDescStatus = document.getElementById('metaDescStatus');
      if (metaDescription && metaDescLength && metaDescStatus) {
        metaDescription.addEventListener('input', function() {
          const length = this.value.length;
          metaDescLength.textContent = length;
          
          if (length === 0) {
            metaDescStatus.textContent = 'Too short';
            metaDescStatus.style.color = '#ef4444';
          } else if (length < 50) {
            metaDescStatus.textContent = 'Too short';
            metaDescStatus.style.color = '#ef4444';
          } else if (length <= 160) {
            metaDescStatus.textContent = 'Good length';
            metaDescStatus.style.color = '#22c55e';
          } else {
            metaDescStatus.textContent = 'Too long';
            metaDescStatus.style.color = '#ef4444';
          }
        });
      }
      
      // Auto-generate slug from title
      const postTitle = document.getElementById('postTitle');
      const postSlug = document.getElementById('postSlug');
      if (postTitle && postSlug) {
        postTitle.addEventListener('blur', function() {
          if (!postSlug.value) {
            postSlug.value = this.value
              .toLowerCase()
              .replace(/[^\w\s]/gi, '')
              .replace(/\s+/g, '-');
          }
        });
      }
      
      // Editor toolbar functionality
      const editorToolbar = document.getElementById('editorToolbar');
      const postContent = document.getElementById('postContent');
      if (editorToolbar && postContent) {
        editorToolbar.querySelectorAll('button').forEach(button => {
          button.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent form submission
            
            const format = this.getAttribute('data-format');
            const textarea = postContent;
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let replacement = '';
            
            switch (format) {
              case 'bold':
                replacement = `**${selectedText || 'bold text'}**`;
                break;
              case 'italic':
                replacement = `*${selectedText || 'italic text'}*`;
                break;
              case 'heading':
                replacement = `## ${selectedText || 'Heading'}`;
                break;
              case 'link':
                replacement = `[${selectedText || 'link text'}](https://example.com)`;
                break;
              case 'list':
                replacement = `- ${selectedText || 'List item'}`;
                break;
              case 'quote':
                replacement = `> ${selectedText || 'Quoted text'}`;
                break;
              case 'code':
                replacement = "```\n" + (selectedText || 'Code block') + "\n```";
                break;
              case 'image':
                replacement = `![${selectedText || 'Image alt text'}](https://example.com/image.jpg)`;
                break;
            }
            
            // Insert replacement
            textarea.focus();
            textarea.setRangeText(
              replacement,
              start,
              end,
              'select'
            );
            
            // Trigger input event to update word count
            textarea.dispatchEvent(new Event('input'));
          });
        });
      }
      
      // Word count functionality
      if (postContent) {
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        
        postContent.addEventListener('input', function() {
          const text = this.value.trim();
          const words = text ? text.split(/\s+/).length : 0;
          const chars = text.length;
          
          wordCount.textContent = words;
          charCount.textContent = chars;
        });
      }
    }
  </script>
  
  <!-- Blog preview functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Preview button functionality
      const previewBtn = document.getElementById('previewBtn');
      const previewModal = document.getElementById('previewModal');
      const closePreview = document.getElementById('closePreview');
      const previewContent = document.getElementById('previewContent');
      const postContent = document.getElementById('postContent');
      
      if (previewBtn && previewModal && closePreview && previewContent && postContent) {
        previewBtn.addEventListener('click', function() {
          // Get markdown content
          const markdown = postContent.value;
          
          // Simplest markdown to HTML converter
          // NOTE: In a real application, you'd use a proper markdown library
          let html = markdown
            // Headers
            .replace(/^## (.*?)$/gm, '<h2>$1</h2>')
            .replace(/^### (.*?)$/gm, '<h3>$1</h3>')
            .replace(/^#### (.*?)$/gm, '<h4>$1</h4>')
            // Bold and italic
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            // Links
            .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
            // Images
            .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width: 100%;">')
            // Lists
            .replace(/^- (.*?)$/gm, '<li>$1</li>')
            // Blockquotes
            .replace(/^> (.*?)$/gm, '<blockquote style="border-left: 4px solid #e5e7eb; padding-left: 15px; color: #6b7280;">$1</blockquote>')
            // Code blocks
            .replace(/```([\s\S]*?)```/g, '<pre style="background-color: #f8fafc; padding: 15px; border-radius: 4px; overflow-x: auto;"><code>$1</code></pre>');
          
          // Wrap list items in ul tags
          html = html.replace(/<li>.*?<\/li>/gs, match => {
            return '<ul style="padding-left: 20px;">' + match + '</ul>';
          });
          
          // Replace newlines with br tags
          html = html.replace(/\n/g, '<br>');
          
          // Update preview content
          previewContent.innerHTML = html;
          
          // Show preview modal
          previewModal.style.display = 'block';
        });
        
        // Close preview
        closePreview.addEventListener('click', function() {
          previewModal.style.display = 'none';
        });
        
        // Close on outside click
        window.addEventListener('click', function(event) {
          if (event.target == previewModal) {
            previewModal.style.display = 'none';
          }
        });
      }
      
      // Add word counter functionality
      // Note: postContent is already defined above, so we don't redefine it
      const wordCount = document.getElementById('wordCount');
      const charCount = document.getElementById('charCount');
      
      if (postContent && wordCount && charCount) {
        postContent.addEventListener('input', function() {
          const text = this.value.trim();
          const words = text ? text.split(/\s+/).length : 0;
          const chars = text.length;
          
          wordCount.textContent = words;
          charCount.textContent = chars;
        });
      }
      
      // Fix blog tab switching
      const blogTabs = document.querySelectorAll('[data-blog-tab]');
      
      if (blogTabs.length > 0) {
        blogTabs.forEach(tab => {
          tab.addEventListener('click', function() {
            // Remove active class from all tabs
            blogTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Hide all blog tab content
            document.querySelectorAll('.blog-tab-content').forEach(content => {
              content.style.display = 'none';
            });
            
            // Show selected tab content
            const tabId = this.getAttribute('data-blog-tab') + 'Tab';
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
              tabContent.style.display = 'block';
            } else {
              console.error(`Tab content with id ${tabId} not found!`);
            }
          });
        });
      }
    });
  </script>
  
  <!-- Analytics scripts -->
  <script src="/admin-dashboard-analytics.js"></script>
</body>
</html>